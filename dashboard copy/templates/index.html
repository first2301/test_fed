<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>연합학습 컨테이너 모니터링 대시보드</title>
  <link rel="stylesheet" href="/static/css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
  <!-- 헤더 섹션 -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-title">
        <i class="fas fa-cube"></i>
        <h1>연합학습 노드 관리</h1>
      </div>
    </div>
  </header>

  <!-- 메인 레이아웃: 사이드바 + 컨텐츠 -->
  <div class="dashboard-layout">
    <!-- 왼쪽 사이드바 -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <button id="tableViewBtn" class="sidebar-item active" onclick="switchView('table')">
          <i class="fas fa-table"></i>
          <span>테이블 보기</span>
        </button>
        <button id="graphViewBtn" class="sidebar-item" onclick="switchView('graph')">
          <i class="fas fa-project-diagram"></i>
          <span>그래프 보기</span>
        </button>
        <div class="sidebar-divider"></div>
        <button id="serverManagerBtn" class="sidebar-item" onclick="switchView('server')">
          <i class="fas fa-server"></i>
          <span>서버 관리</span>
        </button>
        <button id="serverGraphBtn" class="sidebar-item" onclick="switchView('serverGraph')">
          <i class="fas fa-network-wired"></i>
          <span>서버 그래프</span>
        </button>
      </nav>
    </aside>

    <!-- 메인 컨텐츠 영역 -->
    <main class="main-content">
      <!-- 통계 카드 섹션 (테이블/그래프 뷰에서만 표시) -->
      <div id="statsSection" class="stats-container">
        <div class="stat-card">
          <div class="stat-icon" style="background: #6366f1;">
            <i class="fas fa-boxes"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="statTotal">0</div>
            <div class="stat-label">전체 컨테이너</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: #10b981;">
            <i class="fas fa-play-circle"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="statRunning">0</div>
            <div class="stat-label">실행 중</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: #64748b;">
            <i class="fas fa-stop-circle"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="statStopped">0</div>
            <div class="stat-label">중지됨</div>
          </div>
        </div>
      </div>

      <!-- 툴바 섹션 (테이블/그래프 뷰에서만 표시) -->
      <div id="toolbarSection" class="toolbar-modern">
        <div class="toolbar-left">
          <div class="select-wrapper">
            <i class="fas fa-network-wired"></i>
            <select id="nodeSelect" class="modern-select">
              {% for node in nodes %}
              <option value="{{ node.id }}">{{ node.label }} ({{ node.id }})</option>
              {% endfor %}
            </select>
          </div>
          <button class="btn-modern btn-primary" onclick="reloadContainers()">
            <i class="fas fa-sync-alt"></i>
            <span>새로고침</span>
          </button>
        </div>
        <div class="toolbar-right">
          <div class="status-badge" id="statusText"></div>
        </div>
      </div>

      <!-- 테이블 뷰 (카드 그리드) -->
      <div id="tableView" class="view-container">
        <div id="containerGrid" class="container-grid">
          <!-- JS가 카드로 채움 -->
        </div>
      </div>

      <!-- 그래프 뷰 -->
      <div id="graphView" class="view-container" style="display: none;">
        <div class="graph-wrapper">
          <div id="cy" class="graph-canvas"></div>
          <div class="graph-controls-modern">
            <button class="btn-icon" onclick="resetGraphLayout()" title="레이아웃 초기화">
              <i class="fas fa-redo"></i>
            </button>
            <button class="btn-icon" onclick="fitGraph()" title="전체 보기">
              <i class="fas fa-expand"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- 서버 관리 뷰 -->
      <div id="serverView" class="view-container" style="display: none;">
        <div class="server-manager-view">
          <div id="serverListSection" class="server-list-section">
            <div class="section-header">
              <h2><i class="fas fa-server"></i> 서버 관리</h2>
              <button class="btn-modern btn-primary" onclick="showAddServerForm()">
                <i class="fas fa-plus"></i>
                <span>서버 추가</span>
              </button>
            </div>
            <div id="serverList" class="server-list">
              <!-- 서버 목록이 여기에 동적으로 추가됨 -->
            </div>
          </div>
        </div>
      </div>

      <!-- 서버 그래프 뷰 -->
      <div id="serverGraphView" class="view-container" style="display: none;">
        <div class="server-graph-layout">
          <!-- 왼쪽: 그래프 영역 -->
          <div class="graph-area">
            <div class="graph-wrapper">
              <div id="serverCy" class="graph-canvas"></div>
              <div class="graph-controls-modern">
                <button class="btn-icon" onclick="resetServerGraphLayout()" title="레이아웃 초기화">
                  <i class="fas fa-redo"></i>
                </button>
                <button class="btn-icon" onclick="fitServerGraph()" title="전체 보기">
                  <i class="fas fa-expand"></i>
                </button>
              </div>
            </div>
          </div>
          <!-- 오른쪽: 상세 정보 패널 -->
          <div id="serverDetailsPanel" class="server-details-panel" style="display: none;">
            <div class="panel-header">
              <h3><i class="fas fa-info-circle"></i> 서버 상세 정보</h3>
              <button class="panel-close" onclick="closeServerDetailsPanel()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="panel-body">
              <div id="serverDetailsContent">
                <!-- 노드 선택 시 여기에 정보 표시 -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- 로딩 오버레이 -->
  <div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>로딩 중...</p>
    </div>
  </div>

  <!-- 서버 추가/수정 모달 -->
  <div id="serverFormModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="serverFormTitle"><i class="fas fa-server"></i> 서버 추가</h2>
        <button class="modal-close" onclick="closeServerFormModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="serverForm" class="server-form" onsubmit="saveServer(event)">
          <div class="form-group">
            <label for="serverId">서버 ID *</label>
            <input type="text" id="serverId" name="id" required 
                   placeholder="예: node1" pattern="[a-zA-Z0-9_-]+"
                   title="영문, 숫자, 언더스코어, 하이픈만 사용 가능">
            <small>고유 식별자 (영문, 숫자, _, - 만 사용)</small>
          </div>
          <div class="form-group">
            <label for="serverLabel">서버 이름 *</label>
            <input type="text" id="serverLabel" name="label" required 
                   placeholder="예: 병원 A 서버">
          </div>
          <div class="form-group">
            <label for="serverUrl">Docker URL *</label>
            <input type="text" id="serverUrl" name="base_url" required 
                   placeholder="예: tcp://10.0.0.5:2376 또는 unix://var/run/docker.sock">
            <small>원격: tcp://IP:PORT, 로컬: unix://var/run/docker.sock</small>
          </div>
          <div class="form-group">
            <label for="serverType">서버 타입</label>
            <select id="serverType" name="type">
              <option value="local">로컬</option>
              <option value="remote">원격</option>
            </select>
          </div>
          <div class="form-group">
            <label for="serverRole">서버 역할 *</label>
            <select id="serverRole" name="role" required>
              <option value="client">클라이언트 서버</option>
              <option value="central">중앙 서버</option>
            </select>
            <small>연합학습에서의 서버 역할을 선택하세요</small>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="serverTls" name="tls">
              TLS 인증서 사용
            </label>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-modern" onclick="testServerConnection()">
              <i class="fas fa-plug"></i>
              <span>연결 테스트</span>
            </button>
            <button type="submit" class="btn-modern btn-primary">
              <i class="fas fa-save"></i>
              <span>저장</span>
            </button>
            <button type="button" class="btn-modern" onclick="closeServerFormModal()">
              <span>취소</span>
            </button>
          </div>
          <div id="serverTestResult" class="test-result" style="display: none;"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- Cytoscape.js 라이브러리 추가 (body 끝에 배치) -->
  <script src="https://unpkg.com/cytoscape@3.27.0/dist/cytoscape.min.js"></script>
  <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
  <script src="https://unpkg.com/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>
  <script src="/static/js/main.js"></script>
</body>
</html>
